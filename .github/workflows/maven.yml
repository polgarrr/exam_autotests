# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Run Tests

env:
  OS: ubuntu-latest
  
on:
  workflow_dispatch

jobs:
  preinstall:
    runs-on: ubuntu-latest
    steps:
      - name: "download Selenoid"
        run: curl -s https://aerokube.com/cm/bash | bash
      - name: "give execution permissions to binary"
        run: chmod +x ./cm
      - name: "start Selenoid"
        run: ./cm selenoid start --vnc
      - name: "start SelenoidUI"
        run: ./cm selenoid-ui start
      - name: "checkout main branch"
        uses: actions/checkout@v3
      - name: "set up JDK 11"
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'
  tests-and-report:
    needs: preinstall
    runs-on: ubuntu-latest
    steps:
      - name: "ls"
        run: ls
      - name: "cd"
        run: cd ..
      - name: "ls 2"
        run: ls
      - name: "Run tests"
        run: mvn --batch-mode test
#       - name: "Generate allure-реreport"
#         uses: simple-elf/allure-report-action@master
#         id: allure-report
#         with:
#          allure_results: allure-results
#          gh_pages: reports
#          allure_report: allure-report
#          allure_history: allure-history
          
#       - name: "Push allure-report into reports branch"
#         uses: peaceiris/actions-reports@v2
#         env:
#          PERSONAL_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#          PUBLISH_BRANCH: reports
#          PUBLISH_DIR: allure-history
